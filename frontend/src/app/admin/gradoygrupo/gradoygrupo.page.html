<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button menu="menuId"></ion-menu-button>
      <ion-back-button text="Regresar"></ion-back-button>
    </ion-buttons>
    <ion-title class="text-center">
      <div class="header-title">
        <img src="assets/img/escuela.png" alt="" class="logo-title">
      </div>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button routerLink="/perfil" title="Mi perfil">
        <ion-icon name="person-circle-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="container">
    <div class="text-center mb-4">
      <h1 class="mt-3 titulo">Salones, Grados y Grupos</h1>
    </div>

    <div class="salones-container">
      <ion-grid fixed>
        <ion-row class="salones-row">
          <ion-col size="12" size-md="3">
            <ion-item lines="none" class="form-item">
              <ion-label position="stacked" class="form-label">Aula</ion-label>
              <ion-input class="salones-input" type="number" (ionInput)="formatAula($event)"
                (ionChange)="change($event)" [(ngModel)]="data.aula" placeholder="Ingrese el aula">
              </ion-input>
            </ion-item>
          </ion-col>

          <ion-col size="12" size-md="3">
            <ion-item lines="none" class="form-item">
              <ion-label position="stacked" class="form-label">Grado</ion-label>
              <ion-input class="salones-input" type="number" (ionChange)="change($event)" [(ngModel)]="data.grado"
                placeholder="Ingrese el grado">
              </ion-input>
            </ion-item>
          </ion-col>

          <ion-col size="12" size-md="3">
            <ion-item lines="none" class="form-item">
              <ion-label position="stacked" class="form-label">Grupo</ion-label>
              <ion-input [(ngModel)]="data.grupo"
                (ionInput)="data.grupo = $event.detail.value ? $event.detail.value.toUpperCase() : ''"
                class="salones-input" placeholder="Ej. A">
              </ion-input>
            </ion-item>
          </ion-col>

          <ion-col size="12" size-md="3">
            <ion-item lines="none" class="form-item">
              <ion-label position="stacked" class="form-label">Periodo</ion-label>
              <ion-input class="salones-input" placeholder="Ej. 2025-1"></ion-input>
            </ion-item>
          </ion-col>


          <!-- Botones cuando NO está editando -->
          <ion-col size="12" size-md="12" *ngIf="!isEditing">
            <ion-button [disabled]="!dataExisting" (click)="create()" expand="block" class="btn-principal">
              <ion-icon slot="start" name="add-circle-outline"></ion-icon>
              Agregar Salón
            </ion-button>
          </ion-col>

          <!-- Botones cuando está editando -->
          <ion-col size="12" class="salones-btn-col" *ngIf="isEditing">
            <ion-grid>
              <ion-row>
                <ion-col size="12" size-md="6">
                  <ion-button expand="block" class="btn-principal" (click)="update()">
                    <ion-icon slot="start" name="add-circle-outline"></ion-icon>
                    Actualizar Salón
                  </ion-button>
                </ion-col>
                <ion-col size="12" size-md="6">
                  <ion-button expand="block" color="medium" (click)="cancel()">
                    <ion-icon slot="start" name="close-circle-outline"></ion-icon>
                    Cancelar
                  </ion-button>
                </ion-col>
              </ion-row>
            </ion-grid>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>

    <div class="container salones-container">
      <h2 class="text-center salon-titulo2">Salones</h2>

      <ion-list class="salon-list">
        <ion-item class="salon-item salon-list-header">
          <ion-label class="salon-col">Aula</ion-label>
          <ion-label class="salon-col">Grado</ion-label>
          <ion-label class="salon-col">Grupo</ion-label>
          <ion-label class="salon-col salon-action">Editar</ion-label>
          <ion-label class="salon-col salon-action">Borrar</ion-label>
        </ion-item>

        <ion-item *ngIf="salones.length === 0" lines="none" class="no-salones-message">
          <ion-icon name="alert-circle-outline" slot="start" class="no-salones-icon"></ion-icon>
          <ion-label>
            No hay salones creados aún. ¡Comienza agregando uno para gestionar tu espacio!
          </ion-label>
        </ion-item>

        <ion-item *ngFor="let s of salones" class="salon-item">
          <ion-label class="salon-col">{{ s.aula }}</ion-label>
          <ion-label class="salon-col">{{ s.grado }}°</ion-label>
          <ion-label class="salon-col">{{ s.grupo }}</ion-label>
          <ion-label class="salon-col salon-action">
            <ion-icon name="pencil-outline" (click)="selectEditar(s)" class="salon-icon-edit"></ion-icon>
          </ion-label>
          <ion-label class="salon-col salon-action">
            <ion-icon name="trash-outline" (click)="openAlert(s)" class="salon-icon-delete"></ion-icon>
          </ion-label>
        </ion-item>
      </ion-list>
    </div>

  </div>

  <ion-alert trigger="present-alert" header="¿Estas seguro de eliminar este salon?"
    [buttons]="alertButtons"></ion-alert>
</ion-content>