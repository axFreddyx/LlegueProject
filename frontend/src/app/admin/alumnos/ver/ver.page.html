<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button menu="menuId"></ion-menu-button>
      <ion-back-button text="Regresar"></ion-back-button>
    </ion-buttons>
    <ion-title class="text-center">
      <div class="header-title">
        <ion-img src="assets/img/escuela.png" alt="logo" class="logo-title"/>
        <!-- <span class="span-title">Panel Administrativo</span> -->
      </div>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button routerLink="/perfil" title="Mi perfil">
        <ion-icon name="person-circle-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <div class="ion-text-center">
    <ion-button routerLink="/importar-alumnos" fill="outline" color="primary">
      üì• Importar desde Excel
    </ion-button>
  </div>
  
  <div class="alumno-container container text-center ion-padding">

    <!-- T√≠tulo y descripci√≥n -->
    <p>Complete la informaci√≥n para registrar un nuevo alumno en el sistema.</p>
    <!-- Formulario -->
    <ion-grid fixed>
      <ion-row>

        <!-- Foto circular -->
        <ion-col size="12">
          <div class="alumno-foto-container">
            <div class="alumno-foto-wrapper">
              <img *ngIf="previewImg" [src]="previewImg" alt="Vista previa" class="alumno-foto" />
              <div *ngIf="!previewImg" class="alumno-foto-placeholder">+</div>
              <ion-input #fileInput type="file" accept="image/*" (change)="onFileChange($event)"
                class="alumno-foto-input" />
            </div>
          </div>
        </ion-col>

        <!-- Nombre -->
        <ion-col size="12" size-md="6">
          <ion-item class="alumno-item">
            <ion-label position="stacked" class="alumno-label">Nombre(s)</ion-label>
            <ion-input type="text" [(ngModel)]="data.nombre" placeholder="Ingrese nombre(s)"
              class="alumno-input"></ion-input>
          </ion-item>
        </ion-col>

        <!-- Apellidos -->
        <ion-col size="12" size-md="6">
          <ion-item class="alumno-item">
            <ion-label position="stacked" class="alumno-label">Apellidos</ion-label>
            <ion-input type="text" [(ngModel)]="data.apellidos" placeholder="Ingrese apellidos"
              class="alumno-input"></ion-input>
          </ion-item>
        </ion-col>

        <!-- <ion-col size="12" size-md="4">
          <ion-item class="alumno-item">
            <ion-label position="stacked" class="alumno-label">Salon</ion-label>
            <ion-input type="text" placeholder="Sal√≥n" class="alumno-input"></ion-input>
          </ion-item>
        </ion-col> -->

        <!-- Bot√≥n agregar otro -->
        <ion-col size="12">
          <ion-button expand="block" *ngIf="data.nombre && data.apellidos" (click)="ingresarOtroAlumno()"
            class="btn-secundario w-100" fill="clear" shape="round">
            Ingresar otro alumno
            <ion-icon name="add-circle-outline" slot="end"></ion-icon>
          </ion-button>
        </ion-col>

        <!-- Lista de alumnos -->
        <ion-col size="12" *ngIf="isIngresado && alumnosIngresados.length > 0">
          <ion-label>Alumnos ingresados</ion-label>
          <table class="alumno-tabla">
            <thead>
              <tr>
                <th>Nombre</th>
                <th>Apellidos</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let alumno of alumnosIngresados">
                <td>{{ alumno.nombre }}</td>
                <td>{{ alumno.apellidos }}</td>
                <td>
                  <ion-button fill="clear" (click)="alumnosIngresados.splice(alumnosIngresados.indexOf(alumno), 1)">
                    <ion-icon name="trash-outline"></ion-icon>
                  </ion-button>
                </td>
              </tr>
            </tbody>
          </table>
        </ion-col>

        <!-- Bot√≥n principal -->
        <ion-col size="12">
          <ion-button expand="block" (click)="save()" class="btn-principal">
            Ingresar Alumno
            <ion-icon name="checkmark-circle-outline" slot="end"></ion-icon>
          </ion-button>
        </ion-col>

      </ion-row>
    </ion-grid>
  </div>

  <div class="veralumno-container container ">
    <h1 class="titulo text-center titulo2">Ver Alumnos</h1>

    <ion-list lines="none" class="ver-alumnos-list">

      <!-- Botones de selecci√≥n -->
      <ion-button (click)="selectingAlumnos()" *ngIf="!isSelecting && alumnos.length !== 0" expand="block" fill="clear"
        shape="round" class="ver-alumnos-btn ver-alumnos-btn-select">
        <ion-icon name="checkmark-outline" slot="start"></ion-icon>
        Seleccionar alumnos
      </ion-button>

      <ion-button (click)="notSelectingAlumnos()" color="medium" *ngIf="isSelecting" expand="block" fill="clear"
        shape="round" class="ver-alumnos-btn ver-alumnos-btn-cancel">
        <ion-icon name="close-outline" slot="start"></ion-icon>
        Cancelar selecci√≥n
      </ion-button>

      <div class="acciones ver-alumnos-acciones" *ngIf="isSelecting && alumnos.length !== 0">
        <ion-checkbox slot="start" color="primary" [(ngModel)]="allSelected" (ionChange)="toggleSelectAll($event)"
          aria-label="Seleccionar todos los alumnos" class="ver-alumnos-checkbox">
        </ion-checkbox>
        <label (click)="toggleSelectAllLabel()" class="select-all-label ver-alumnos-select-all-label">
          Seleccionar todos
        </label>
        <ion-button (click)="openAlertDelete()" size="small" fill="outline" color="danger"
          class="ver-alumnos-btn ver-alumnos-btn-delete">
          ‚ùå Eliminar
        </ion-button>
        <ion-button size="small" (click)="openModalVarios()" fill="outline" color="warning"
          class="ver-alumnos-btn ver-alumnos-btn-assign">
          üè´ Asignar Sal√≥n
        </ion-button>
      </div>

      <!-- Accordion por salones -->
      <ion-accordion-group class="ver-alumnos-accordion-group">
        <!-- Alumnos por sal√≥n -->
        <ion-accordion *ngFor="let s of salones" [value]="s.id">
          <ion-item slot="header" class="acordion-alumnos">
            <ion-label>{{ s.grado }} {{ s.grupo }} ({{ alumnosPorSalon[s.id]?.length || 0 }} alumnos)</ion-label>
          </ion-item>
          <div class="ion-padding ver-alumnos-accordion-content" slot="content">
            <ion-item *ngFor="let a of alumnosPorSalon[s.id]" class="ver-alumnos-item"
              (click)="isSelecting ? clickAlumno(a) : null">

              <ion-checkbox disabled *ngIf="isSelecting" slot="start" color="primary" [(ngModel)]="a.selected"
                (click)="selectAlumnos(a)" [attr.aria-label]="'Seleccionar alumno ' + a.nombre + ' ' + a.apellidos"
                class="ver-alumnos-checkbox">
              </ion-checkbox>

              <ion-avatar slot="start" class="ver-alumnos-avatar">
                <img [src]="getFotoUrl(a) || 'assets/img/ejemplo.jpg'" [alt]="a.nombre + ' ' + a.apellidos" />
              </ion-avatar>

              <ion-label class="ver-alumnos-label">
                <h2 class="ver-alumnos-nombre">{{ a.nombre }} {{ a.apellidos }}</h2>
                <p class="ver-alumnos-id">ID: {{ a.id }}</p>
                <div class="acciones ver-alumnos-acciones-item" *ngIf="!isSelecting">
                  <ion-button routerLink="/editar/alumno/{{a.documentId}}" size="small" fill="outline" color="primary"
                    class="ver-alumnos-btn ver-alumnos-btn-edit">
                    üìù Editar
                  </ion-button>
                  <ion-button (click)="openAlertDelete(a)" size="small" fill="outline" color="danger"
                    class="ver-alumnos-btn ver-alumnos-btn-delete">
                    ‚ùå Eliminar
                  </ion-button>
                  <ion-button (click)="openModal(a)" size="small" fill="outline" color="warning"
                    class="ver-alumnos-btn ver-alumnos-btn-assign">
                    üè´ Asignar Sal√≥n
                  </ion-button>
                </div>
              </ion-label>
            </ion-item>
          </div>
        </ion-accordion>

        <!-- Alumnos sin sal√≥n -->
        <ion-accordion value="sin-salon">
          <ion-item slot="header" class="acordion-alumnos">
            <ion-label>Alumnos sin Sal√≥n Asignado</ion-label>
          </ion-item>
          <div class="ion-padding ver-alumnos-accordion-content" slot="content">
            <ion-item *ngFor="let a of alumnosSinSalon" class="ver-alumnos-item"
              (click)="isSelecting ? clickAlumno(a) : null">

              <ion-checkbox disabled *ngIf="isSelecting" slot="start" color="primary" [(ngModel)]="a.selected"
                (click)="selectAlumnos(a)" [attr.aria-label]="'Seleccionar alumno ' + a.nombre + ' ' + a.apellidos"
                class="ver-alumnos-checkbox">
              </ion-checkbox>

              <ion-avatar slot="start" class="ver-alumnos-avatar">
                <img [src]="getFotoUrl(a) || 'assets/img/ejemplo.jpg'" [alt]="a.nombre + ' ' + a.apellidos" />
              </ion-avatar>

              <ion-label class="ver-alumnos-label">
                <h2 class="ver-alumnos-nombre">{{ a.nombre }} {{ a.apellidos }}</h2>
                <p class="ver-alumnos-id">ID: {{ a.id }}</p>
                <div class="acciones ver-alumnos-acciones-item" *ngIf="!isSelecting">
                  <ion-button routerLink="/editar/alumno/{{a.documentId}}" size="small" fill="outline" color="primary"
                    class="ver-alumnos-btn ver-alumnos-btn-edit">
                    üìù Editar
                  </ion-button>
                  <ion-button (click)="openAlertDelete(a)" size="small" fill="outline" color="danger"
                    class="ver-alumnos-btn ver-alumnos-btn-delete">
                    ‚ùå Eliminar
                  </ion-button>
                  <ion-button (click)="openModal(a)" size="small" fill="outline" color="warning"
                    class="ver-alumnos-btn ver-alumnos-btn-assign">
                    üè´ Asignar Sal√≥n
                  </ion-button>
                </div>
              </ion-label>
            </ion-item>
          </div>
        </ion-accordion>

      </ion-accordion-group>
    </ion-list>
  </div>




  <!-- <div class="ver-alumnos-container container ver-alumnos-main">

    <h1 class="titulo text-center ver-alumnos-titulo">Ver Alumnos</h1>

    <ion-list lines="none" class="ver-alumnos-list">

      <ion-button (click)="selectingAlumnos()" *ngIf="!isSelecting && alumnos.length !== 0" expand="block" fill="clear"
        shape="round" class="ver-alumnos-btn ver-alumnos-btn-select">
        <ion-icon name="checkmark-outline" slot="start"></ion-icon>
        Seleccionar alumnos
      </ion-button>

      <ion-button (click)="notSelectingAlumnos()" color="medium" *ngIf="isSelecting" expand="block" fill="clear"
        shape="round" class="ver-alumnos-btn ver-alumnos-btn-cancel">
        <ion-icon name="close-outline" slot="start"></ion-icon>
        Cancelar selecci√≥n
      </ion-button>

      <div class="acciones ver-alumnos-acciones" *ngIf="isSelecting && alumnos.length !== 0">
        <ion-checkbox slot="start" color="primary" [(ngModel)]="allSelected" (ionChange)="toggleSelectAll($event)"
          aria-label="Seleccionar todos los alumnos" class="ver-alumnos-checkbox">
        </ion-checkbox>
        <label (click)="toggleSelectAllLabel()" class="select-all-label ver-alumnos-select-all-label">
          Seleccionar todos
        </label>
        <ion-button (click)="openAlertDelete()" size="small" fill="outline" color="danger"
          class="ver-alumnos-btn ver-alumnos-btn-delete">
          ‚ùå Eliminar
        </ion-button>
        <ion-button size="small" (click)="openModalVarios()" fill="outline" color="warning"
          class="ver-alumnos-btn ver-alumnos-btn-assign">
          üè´ Asignar Sal√≥n
        </ion-button>
      </div>

      <ion-card class="ver-alumnos-card" *ngIf="alumnos.length === 0">
        <ion-card-header>
          <ion-card-title>No hay alumnos inscritos</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>A√∫n no hay alumnos inscritos. Puedes inscribir nuevos alumnos haciendo clic en el bot√≥n "Inscribir Alumno"
            arriba.</p>
        </ion-card-content>
      </ion-card>

      <ion-item class="docente-item ver-alumnos-item" *ngFor="let a of alumnos"
        (click)="isSelecting ? clickAlumno(a) : null">
        <ion-checkbox disabled *ngIf="isSelecting" slot="start" color="primary" [(ngModel)]="a.selected"
          (click)="selectAlumnos(a)" [attr.aria-label]="'Seleccionar alumno ' + a.nombre + ' ' + a.apellidos"
          class="ver-alumnos-checkbox-item">
        </ion-checkbox>

        <ion-avatar slot="start" [style.margin-left]="isSelecting ? '10px' : '0'" class="ver-alumnos-avatar">
          <img [src]="getFotoUrl(a) || 'assets/img/ejemplo.jpg'"
            [alt]="(a?.nombre || a?.attributes?.nombre || '') + ' ' + (a?.apellidos || a?.attributes?.apellidos || '')"
            class="ver-alumnos-img" />
        </ion-avatar>

        <ion-label class="ver-alumnos-label">
          <h2 class="ver-alumnos-nombre">{{a.nombre}} {{a.apellidos}}</h2>
          <p class="ver-alumnos-id">ID: {{a.id}}</p>
          <p class="ver-alumnos-salon">
            Grado y Grupo:
            <span *ngIf="a.salon === null" class="text-danger">No asignado</span>
            <span *ngIf="a.salon !== null">{{a.salon.grado}} {{a.salon.grupo}}</span>
          </p>

          <div class="acciones ver-alumnos-item-acciones" *ngIf="!isSelecting">
            <ion-button routerLink="/editar/alumno/{{a.documentId}}" size="small" fill="outline" color="primary"
              class="ver-alumnos-btn ver-alumnos-btn-edit">
              üìù Editar
            </ion-button>
            <ion-button (click)="openAlertDelete(a)" size="small" fill="outline" color="danger"
              class="ver-alumnos-btn ver-alumnos-btn-delete">
              ‚ùå Eliminar
            </ion-button>
            <ion-button (click)="openModal(a)" size="small" fill="outline" color="warning"
              class="ver-alumnos-btn ver-alumnos-btn-assign">
              üè´ Asignar Sal√≥n
            </ion-button>
          </div>
        </ion-label>
      </ion-item>

    </ion-list>
  </div> -->

  <ion-modal trigger="open-modal">
    <ng-template>
      <ion-header>
        <ion-toolbar color="primary">
          <ion-title>Salones Disponibles</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="cancel()" color="light" fill="solid" shape="round" size="small"
              aria-label="Cerrar modal">
              <ion-icon name="close-outline"></ion-icon>
              Cerrar
            </ion-button>

          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding modal-salones-content">
        <div class="salones-header">
          <h2>Salones Disponibles</h2>
          <p *ngIf="alumnosSeleccionados.length === 0">Selecciona un sal√≥n para asignar al alumno <b>{{alumno?.nombre}}
              {{alumno?.apellidos}}</b></p>
          <p *ngIf="alumnosSeleccionados.length > 1">Selecciona un sal√≥n para asignar a
            <b>{{alumnosSeleccionados.length}}</b> alumnos
          </p>
        </div>
        <ion-card *ngIf="salones.length === 0" class="no-salones-card">
          <ion-card-header>
            <ion-card-title>No hay salones disponibles</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <p>Actualmente no hay salones disponibles para asignar.</p>
          </ion-card-content>
        </ion-card>
        <div class="salones-container">
          <ion-card *ngFor="let salon of salones" class="salon-card" (click)="openAlert(salon)">
            <ion-card-header>
              <ion-card-title>{{ salon.grado }} ¬∞ {{salon.grupo}}</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <p class="alumnos-text">Total de alumnos: {{ salon.totalAlumnos }}</p>
            </ion-card-content>
          </ion-card>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

  <ion-alert trigger="present-alert"
    header="¬øDeseas asignar {{salon?.grado}} ¬∞ {{salon?.grupo}} al alumno {{alumno?.nombre}} {{alumno?.apellidos}}?"
    [buttons]="alertButtons"></ion-alert>

  <!-- Alert para eliminar -->
  <!-- <ion-alert id="delete" trigger="present-alert"
    [header]="alertHeaderDelete"
    [buttons]="alertButtonsDelete"></ion-alert> -->
  <ion-alert #deleteAlert [header]="alertHeaderDelete" [buttons]="alertButtonsDelete"></ion-alert>

</ion-content>