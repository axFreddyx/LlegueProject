<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button menu="menuId"></ion-menu-button>
      <ion-back-button text="Regresar"></ion-back-button>
    </ion-buttons>
    <ion-title class="text-center">
      <div class="header-title">
        <img src="assets/img/escuela.png" alt="" class="logo-title">
        <!-- <span class="span-title">Panel Administrativo</span> -->
      </div>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button routerLink="/perfil" title="Mi perfil">
        <ion-icon name="person-circle-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="container">

    <h1 class="titulo text-center">Ver Alumnos</h1>
     <div class="text-center">
      <ion-button class="cuenta-btn" fill="solid" size="large" routerLink="/create/alumnos">
        <ion-icon slot="start" name="person-add-outline"></ion-icon>
        Inscribir Alumno
      </ion-button>
    </div>
    <ion-list lines="none">
      <ion-button (click)="selectingAlumnos()" *ngIf="!isSelecting && alumnos.length !== 0" expand="block" fill="clear" shape="round">
        <ion-icon name="checkmark-outline" slot="start"></ion-icon>
        Seleccionar alumnos
      </ion-button>
      <ion-button (click)="notSelectingAlumnos()" color="medium" *ngIf="isSelecting" expand="block" fill="clear"
        shape="round">
        <ion-icon name="close-outline" slot="start"></ion-icon>
        Cancelar selecci√≥n
      </ion-button>
      <div class="acciones" *ngIf="isSelecting && alumnos.length !== 0">
        <ion-checkbox slot="start" color="primary" [(ngModel)]="allSelected" (ionChange)="toggleSelectAll($event)"
          aria-label="Seleccionar todos los alumnos">
        </ion-checkbox>
        <label (click)="toggleSelectAllLabel()" class="select-all-label">
          Seleccionar todos
        </label>
        <ion-button (click)="openAlertDelete()" size="small" fill="outline" color="danger">
          ‚ùå Eliminar
        </ion-button>
        <ion-button size="small" fill="outline" color="warning">
          üè´ Asignar Sal√≥n
        </ion-button>
      </div>
      <ion-card>
        <ion-card-header *ngIf="alumnos.length === 0">
          <ion-card-title>No hay alumnos inscritos</ion-card-title>
        </ion-card-header>
        <ion-card-content *ngIf="alumnos.length === 0">
          <p>A√∫n no hay alumnos inscritos. Puedes inscribir nuevos alumnos haciendo clic en el bot√≥n "Inscribir Alumno" arriba.</p>
        </ion-card-content>
      </ion-card>
      <ion-item class="docente-item" *ngFor="let a of alumnos" (click)="isSelecting ? clickAlumno(a) : null">
        <!-- CHECKBOX -->
        <ion-checkbox disabled *ngIf="isSelecting" slot="start" color="primary" [(ngModel)]="a.selected"
          (click)="selectAlumnos(a)"
          [attr.aria-label]="'Seleccionar alumno ' + a.nombre + ' ' + a.apellidos"></ion-checkbox>

        <ion-avatar slot="start" [style.margin-left]="isSelecting ? '10px' : '0'">
          <img src="assets/img/ejemplo.jpg" alt="Ana L√≥pez" />
        </ion-avatar>
        <ion-label>
          <h2>{{a.nombre}} {{a.apellidos}}</h2>
          <p>ID: {{a.id}}</p>
          <p>
            Grado y Grupo:
            <span *ngIf="a.salon === null" class="text-danger">No asignado</span>
            <span *ngIf="a.salon !== null">{{a.salon.grado}} {{a.salon.grupo}}</span>
          </p>
          <div class="acciones">
            <ion-button routerLink="/editar/alumno/{{a.documentId}}" *ngIf="!isSelecting" size="small" fill="outline" color="primary">
              üìù Editar
            </ion-button>
            <ion-button (click)="openAlertDelete(a)" *ngIf="!isSelecting" size="small" fill="outline" color="danger">
              ‚ùå Eliminar
            </ion-button>
            <ion-button *ngIf="!isSelecting" (click)="openModal(a)" size="small" fill="outline" color="warning">
              üè´ Asignar Sal√≥n
            </ion-button>
          </div>
        </ion-label>
      </ion-item>
    </ion-list>
  </div>

  <ion-modal trigger="open-modal">
    <ng-template>
      <ion-header>
        <ion-toolbar color="primary">
          <ion-title>Salones Disponibles</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="cancel()" color="light" fill="solid" shape="round" size="small"
              aria-label="Cerrar modal">
              <ion-icon name="close-outline"></ion-icon>
              Cerrar
            </ion-button>

          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding modal-salones-content">
        <div class="salones-header">
          <h2>Salones Disponibles</h2>
          <p>Selecciona un sal√≥n para asignar al alumno <b>{{alumno?.nombre}} {{alumno?.apellidos}}</b></p>
        </div>
        <ion-card *ngIf="salones.length === 0" class="no-salones-card">
          <ion-card-header>
            <ion-card-title>No hay salones disponibles</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <p>Actualmente no hay salones disponibles para asignar.</p>
          </ion-card-content>
        </ion-card>
        <div class="salones-container">
          <ion-card *ngFor="let salon of salones" class="salon-card" (click)="openAlert(salon)">
            <ion-card-header>
              <ion-card-title>{{ salon.grado }} ¬∞ {{salon.grupo}}</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <p class="alumnos-text">Total de alumnos: {{ salon.totalAlumnos }}</p>
            </ion-card-content>
          </ion-card>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

  <ion-alert trigger="present-alert"
    header="¬øDeseas asignar {{salon?.grado}} ¬∞ {{salon?.grupo}} al alumno {{alumno?.nombre}} {{alumno?.apellidos}}?"
    [buttons]="alertButtons"></ion-alert>

  <!-- Alert para eliminar -->
  <!-- <ion-alert id="delete" trigger="present-alert"
    [header]="alertHeaderDelete"
    [buttons]="alertButtonsDelete"></ion-alert> -->
  <ion-alert #deleteAlert [header]="alertHeaderDelete" [buttons]="alertButtonsDelete"></ion-alert>

</ion-content>