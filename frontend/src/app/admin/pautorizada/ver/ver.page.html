<ion-header>
    <ion-toolbar color="primary">
        <ion-buttons slot="start">
            <ion-menu-button menu="menuId"></ion-menu-button>
            <ion-back-button text="Regresar"></ion-back-button>
        </ion-buttons>
        <ion-title class="text-center">
            <div class="header-title">
                <img src="assets/img/escuela.png" alt="" class="logo-title">
                <!-- <span class="span-title">Panel Administrativo</span> -->
            </div>
        </ion-title>
        <ion-buttons slot="end">
            <ion-button routerLink="/perfil" title="Mi perfil">
                <ion-icon name="person-circle-outline"></ion-icon>
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
    <div class="container">

        <h1 class="titulo text-center">Ver Personas</h1>
        <div class="text-center">
            <ion-button class="cuenta-btn" fill="solid" size="large" (click)="redirect()">
                <ion-icon slot="start" name="person-add-outline"></ion-icon>
                Registrar padre o tutor
            </ion-button>
        </div>
        <ion-list lines="none">
            <ion-button (click)="selectingPersonas()" *ngIf="!isSelecting && personas.length !== 0" expand="block"
                fill="clear" shape="round">
                <ion-icon name="checkmark-outline" slot="start"></ion-icon>
                Seleccionar personas
            </ion-button>
            <ion-button (click)="notSelectingPersonas()" color="medium" *ngIf="isSelecting" expand="block" fill="clear"
                shape="round">
                <ion-icon name="close-outline" slot="start"></ion-icon>
                Cancelar selecci√≥n
            </ion-button>
            <div class="acciones" *ngIf="isSelecting && personas.length !== 0">
                <ion-checkbox slot="start" color="primary" [(ngModel)]="allSelected"
                    (ionChange)="toggleSelectAll($event)" aria-label="Seleccionar todos los alumnos">
                </ion-checkbox>
                <label (click)="toggleSelectAllLabel()" class="select-all-label">
                    Seleccionar todos
                </label>
                <ion-button (click)="openAlertDelete()" size="small" fill="outline" color="danger">
                    ‚ùå Eliminar
                </ion-button>
            </div>
            <ion-card>
                <ion-card-header *ngIf="personas.length === 0">
                    <ion-card-title>No hay alumnos inscritos</ion-card-title>
                </ion-card-header>
                <ion-card-content *ngIf="personas.length === 0">
                    <p>A√∫n no hay padres o tutores inscritos. Puedes inscribir nuevos padres o tutores haciendo clic en
                        el bot√≥n "Registrar Padre o tutor" arriba.</p>
                </ion-card-content>
            </ion-card>
            <ion-item class="docente-item" *ngFor="let p of personas"
                (click)="isSelecting ? clickPersona_autorizada(p) : null">
                <!-- CHECKBOX -->
                <ion-checkbox disabled *ngIf="isSelecting" slot="start" color="primary" [(ngModel)]="p.selected"
                    (click)="selectPersonas(p)"
                    [attr.aria-label]="'Seleccionar persona ' + p.nombre + ' ' + p.apellidos"></ion-checkbox>

                <ion-avatar slot="start" [style.margin-left]="isSelecting ? '10px' : '0'">
                    <img src="assets/img/ejemplo.jpg" alt="Ana L√≥pez" />
                </ion-avatar>
                <ion-label>
                    <h2>{{p.nombre}} {{p.apellidos}}</h2>
                    <p>ID: {{p.id}}</p>
                    <!-- <p>
            Grado y Grupo:
            <span *ngIf="a.salon === null" class="text-danger">No asignado</span>
            <span *ngIf="a.salon !== null">{{a.salon.grado}} {{a.salon.grupo}}</span>
          </p> -->
                    <div class="acciones" *ngIf="!isSelecting">
                        <ion-button (click)="redirectToEditPersona(p)" size="small" fill="outline"
                            color="primary">
                            üìù Editar
                        </ion-button>
                        <ion-button (click)="openAlertDelete(p)" size="small" fill="outline" color="danger">
                            ‚ùå Eliminar
                        </ion-button>
                        <ion-button (click)="openModal(p)" size="small" fill="outline" color="warning">
                            üè´ Asignar alumnos
                        </ion-button>
                    </div>
                </ion-label>
            </ion-item>
        </ion-list>
    </div>

    <ion-modal #modal>
        <ng-template>
            <ion-header>
                <ion-toolbar>
                    <ion-title>Seleccione sus Alumnos</ion-title>
                    <ion-buttons slot="end">
                        <ion-button color="danger" (click)="cancel()">Cerrar</ion-button>
                    </ion-buttons>
                </ion-toolbar>
            </ion-header>
            <ion-content class="ion-padding bg-light">
                <ion-item>
                    <ion-label position="fixed">Buscar sal√≥n:</ion-label>
                    <ion-input [(ngModel)]="searchTerm" (ionInput)="filtrarSalones()"
                        placeholder="Ej. 01, B"></ion-input>
                </ion-item>

                <ion-accordion-group expand="inset" *ngFor="let s of filteredSalones">
                    <ion-accordion [value]="'salon' + s.id">
                        <ion-item slot="header" color="light">
                            <ion-label>
                                <strong>Sal√≥n {{ s.aula }} - {{ s.grado }}¬∞ {{ s.grupo }}</strong>
                            </ion-label>
                        </ion-item>

                        <div class="ion-padding" slot="content">
                            <ion-item>
                                <ion-label position="fixed">Buscar alumno:</ion-label>
                                <ion-input [(ngModel)]="alumnoSearchTerm" placeholder="Ej. Juan, Mart√≠nez"></ion-input>
                            </ion-item>

                            <ion-list *ngIf="filtrarAlumnos(s.alumnos).length > 0; else sinAlumnos">
                                <ion-item *ngFor="let alumno of filtrarAlumnos(s.alumnos)">
                                    <ion-label>{{ alumno.nombre }} {{ alumno.apellidos }}</ion-label>

                                    <ng-container
                                        *ngIf="!esAlumnoAsignadoOSeleccionado(alumno.id); else yaSeleccionado">
                                        <ion-button (click)="selectAlumnos(alumno)" size="small" color="primary"
                                            fill="outline">
                                            Seleccionar
                                        </ion-button>
                                    </ng-container>
                                    <ng-template #yaSeleccionado>
                                        <ion-badge color="success">Seleccionado</ion-badge>
                                    </ng-template>


                                </ion-item>
                            </ion-list>
                            <ng-template #sinAlumnos>
                                <ion-text color="medium">No hay alumnos publicados en este sal√≥n.</ion-text>
                            </ng-template>
                        </div>

                    </ion-accordion>
                </ion-accordion-group>
                <ion-list *ngIf="getTodosLosAlumnos().length > 0">
                    <ion-list-header color="light">
                        <ion-label>Alumnos seleccionados:</ion-label>
                    </ion-list-header>

                    <ion-item *ngFor="let a of getTodosLosAlumnos()">
                        <ion-label>
                            {{ a.nombre }} {{ a.apellidos }} - Grado y grupo: {{ a.salon.grado }} - {{ a.salon.grupo }}
                        </ion-label>

                        <ion-button size="small" color="danger" fill="clear" (click)="quitarAlumno(a.id)">
                            {{ esAlumnoAsignadoBD(a.id) ? 'Designar Alumno' : 'Quitar' }}
                        </ion-button>


                    </ion-item>

                </ion-list>
                <ion-button (click)="asignarAlumnos()" fill="clear" expand="block" class="btn-principal">
                    Agregar Alumno
                </ion-button>
            </ion-content>

        </ng-template>
    </ion-modal>

    <ion-alert trigger="present-alert" [buttons]="alertButtons"></ion-alert>

    <!-- Alert para eliminar -->
    <!-- <ion-alert id="delete" trigger="present-alert"
    [header]="alertHeaderDelete"
    [buttons]="alertButtonsDelete"></ion-alert> -->
    <ion-alert #deleteAlert [header]="alertHeaderDelete" [buttons]="alertButtonsDelete"></ion-alert>

</ion-content>