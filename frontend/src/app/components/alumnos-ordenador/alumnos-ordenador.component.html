<div class="ver-alumnos-container container ver-alumnos-main">

    <h1 class="titulo text-center ver-alumnos-titulo">Ver Alumnos</h1>

    <ion-list lines="none" class="ver-alumnos-list">



      <ion-button (click)="selectingAlumnos()" *ngIf="!isSelecting && alumnos.length !== 0" expand="block" fill="clear"
        shape="round" class="ver-alumnos-btn ver-alumnos-btn-select">
        <ion-icon name="checkmark-outline" slot="start"></ion-icon>
        Seleccionar alumnos
      </ion-button>

      <ion-button (click)="notSelectingAlumnos()" color="medium" *ngIf="isSelecting" expand="block" fill="clear"
        shape="round" class="ver-alumnos-btn ver-alumnos-btn-cancel">
        <ion-icon name="close-outline" slot="start"></ion-icon>
        Cancelar selecci√≥n
      </ion-button>

      <div class="acciones ver-alumnos-acciones" *ngIf="isSelecting && alumnos.length !== 0">
        <ion-checkbox slot="start" color="primary" [(ngModel)]="allSelected" (ionChange)="toggleSelectAll($event)"
          aria-label="Seleccionar todos los alumnos" class="ver-alumnos-checkbox">
        </ion-checkbox>
        <label (click)="toggleSelectAllLabel()" class="select-all-label ver-alumnos-select-all-label">
          Seleccionar todos
        </label>
        <ion-button (click)="openAlertDelete()" size="small" fill="outline" color="danger"
          class="ver-alumnos-btn ver-alumnos-btn-delete">
          ‚ùå Eliminar
        </ion-button>
        <ion-button size="small" (click)="openModalVarios()" fill="outline" color="warning"
          class="ver-alumnos-btn ver-alumnos-btn-assign">
          üè´ Asignar Sal√≥n
        </ion-button>
      </div>

      <ion-grid fixed>
        <ion-row>
          <ion-col size="6">
            <ion-button  expand="block" shape="round">
              Alumnos con salon
            </ion-button>
          </ion-col>
          <ion-col size="6">
            <ion-button expand="block" shape="round">
              Alumnos sin salon
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>
      <ion-card class="ver-alumnos-card" *ngIf="alumnos.length === 0">
        <ion-card-header>
          <ion-card-title>No hay alumnos inscritos</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>A√∫n no hay alumnos inscritos. Puedes inscribir nuevos alumnos haciendo clic en el bot√≥n "Inscribir Alumno"
            arriba.</p>
        </ion-card-content>
      </ion-card>

      <ion-item class="docente-item ver-alumnos-item" *ngFor="let a of alumnos"
        (click)="isSelecting ? clickAlumno(a) : null">
        <ion-checkbox disabled *ngIf="isSelecting" slot="start" color="primary" [(ngModel)]="a.selected"
          (click)="selectAlumnos(a)" [attr.aria-label]="'Seleccionar alumno ' + a.nombre + ' ' + a.apellidos"
          class="ver-alumnos-checkbox-item">
        </ion-checkbox>

        <ion-avatar slot="start" [style.margin-left]="isSelecting ? '10px' : '0'" class="ver-alumnos-avatar">
          <img alt="Imagen del alumno" [src]="getFotoUrl(a) || 'assets/img/ejemplo.jpg'"
            [alt]="(a?.nombre || a?.attributes?.nombre || '') + ' ' + (a?.apellidos || a?.attributes?.apellidos || '')"
            class="ver-alumnos-img" />
        </ion-avatar>

        <ion-label class="ver-alumnos-label">
          <h2 class="ver-alumnos-nombre">{{a.nombre}} {{a.apellidos}}</h2>
          <p class="ver-alumnos-id">ID: {{a.id}}</p>
          <p class="ver-alumnos-salon">
            Grado y Grupo:
            <span *ngIf="a.salon === null" class="text-danger">No asignado</span>
            <span *ngIf="a.salon !== null">{{a.salon.grado}} {{a.salon.grupo}}</span>
          </p>

          <div class="acciones ver-alumnos-item-acciones" *ngIf="!isSelecting">
            <ion-button routerLink="/editar/alumno/{{a.documentId}}" size="small" fill="outline" color="primary"
              class="ver-alumnos-btn ver-alumnos-btn-edit">
              üìù Editar
            </ion-button>
            <ion-button (click)="openAlertDelete(a)" size="small" fill="outline" color="danger"
              class="ver-alumnos-btn ver-alumnos-btn-delete">
              ‚ùå Eliminar
            </ion-button>
            <ion-button (click)="openModal(a)" size="small" fill="outline" color="warning"
              class="ver-alumnos-btn ver-alumnos-btn-assign">
              üè´ Asignar Sal√≥n
            </ion-button>
          </div>
        </ion-label>
      </ion-item>

    </ion-list>
  </div>

  <ion-modal trigger="open-modal">
    <ng-template>
      <ion-header>
        <ion-toolbar color="primary">
          <ion-title>Salones Disponibles</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="cancel()" color="light" fill="solid" shape="round" size="small"
              aria-label="Cerrar modal">
              <ion-icon name="close-outline"></ion-icon>
              Cerrar
            </ion-button>

          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding modal-salones-content">
        <div class="salones-header">
          <h2>Salones Disponibles</h2>
          <p *ngIf="alumnosSeleccionados.length === 0">Selecciona un sal√≥n para asignar al alumno <b>{{alumno?.nombre}}
              {{alumno?.apellidos}}</b></p>
          <p *ngIf="alumnosSeleccionados.length > 1">Selecciona un sal√≥n para asignar a
            <b>{{alumnosSeleccionados.length}}</b> alumnos
          </p>
        </div>
        <ion-card *ngIf="salones.length === 0" class="no-salones-card">
          <ion-card-header>
            <ion-card-title>No hay salones disponibles</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <p>Actualmente no hay salones disponibles para asignar.</p>
          </ion-card-content>
        </ion-card>
        <div class="salones-container">
          <ion-card *ngFor="let salon of salones" class="salon-card" (click)="openAlert(salon)">
            <ion-card-header>
              <ion-card-title>{{ salon.grado }} ¬∞ {{salon.grupo}}</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <p class="alumnos-text">Total de alumnos: {{ salon.totalAlumnos }}</p>
            </ion-card-content>
          </ion-card>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

  <ion-alert trigger="present-alert"
    header="¬øDeseas asignar {{salon?.grado}} ¬∞ {{salon?.grupo}} al alumno {{alumno?.nombre}} {{alumno?.apellidos}}?"
    [buttons]="alertButtons"></ion-alert>


  <ion-alert #deleteAlert [header]="alertHeaderDelete" [buttons]="alertButtonsDelete"></ion-alert>